## 프로세스의 동적 할당 영역
프로세스는 코드 영역, 데이터 영역, 스택 영역으로 이루어져 있는데, 정확히 말하면 힙 영역도 있다.
- 정적 할당 영역
  - 코드 영역: 프로그램의 본체가 있는 곳
  - 데이터 영역: 변수와 데이터가 있는 곳
- 동적 할당 영역
  - 힙 영역, 스택 영역: 프로세스가 실행되는 동안 만들어지는 영역

## 스택 영역
```c
int main() {
  int a=1, b=2;
  printf("%d %d", a, b);
  add(a, b);
  exit();
}

add(int a, int b) {
  mul(a, b);
  printf("%d", c);
}

mul(int a, int b) {
  printf("%d", a*b);
}
```
스택은 함수 호출 시 두 가지 작업을 구현하기 위해 사용한다.
1. 호출한 함수가 종료되면 함수를 호출하기 전 코드로 되돌아와야 하는데 되돌아올 메모리의 주소를 스택에 저장한다. 함수 호출과 복귀 시에 스택이 사용된다.
2. 지역 변수를 저장할 때 스택을 사용한다.

main() 함수가 add() 함수를 호출하면 스택에 되돌아올 위치 정보와 add() 함수에서 사용하는 지역 변수를 저장한다. 그리고 add() 함수가 mul() 함수를 호출하면 
스택에 위치 정보와 mul() 함수에서 사용하는 지역 변수를 넣는다. 함수를 호출할 때마다 필요한 정보가 스택에 push되고, mul() 함수가 종료되면 pop되어 add()  
함수로 돌아가고 add() 함수가 종료되면 pop되어 main() 함수로 돌아간다.

스택은 스레드가 작동하는 동안 추가되거나 삭제되는 동적 할당 영역이다.

## 힙 영역
힙은 동적으로 할당되는 변수 영역이다. 대부분의 데이터는 데이터 영역에 할당되고 그 크기가 정해진다. 그러나 일부 데이터는 프로그램이 실행되는 동안 할당된다.
대표적인 경우가 malloc() 함수다.
```c
int main() {
  int sarr[50];
  int *darr;
  
  darr=(int*)malloc(sizeof(int)*50);
  
  free(darr);

  exit();
}
```
malloc() 함수의 변수 선언부를 보면 sarr은 50개짜리 정수 배열이고, darr은 포인터로서 그 크기가 아직 정해지지 않았다. 이 프로그램을 실행하면 sarr은
데이터 영역에 50개짜리 정수 배열이 자리를 차지하지만, darr은 빈 상태로 실행되다가 malloc를 만나면 그때야 메모리에 자리를 차지한다. 

따라서 sarr은 데이터 영역에 할당되고, darr은 힙 영역에 할당된다. 둘의 중요한 차이점은 sarr은 프로그램이 종료될 때까지 메모리에 남아있지만, darr은 free() 함수를
통해 메모리 공간을 반환했다는 점이다.

## exit() 시스템 콜
exit() 함수는 작업의 종료를 알려주는 시스템 콜이다. 모든 프로세스는 부모-자식 관계를 가지고, 이 관계를 가지는 이유는 사용하던 자원을 회수하기가 용이하기 때문이다.
exit() 함수를 사용함으로써 부모 프로세스는 자식 프로세스가 사용하던 자원을 빨리 거둬 갈 수 있다.
```c
int main() {
  int pid;
  
  pid=fork();
  
    if(pid==0) {
        printf("자식 프로세스\n");
        exit(0);
    }
    else {
        printf("부모 프로세스\n");
        exit(0);
    }
}
```
위의 코드를 부모-자식 프로세스가 같이 사용한다고 가정하면 어떤 프로세스가 먼저 실행될지 알 수 없다.


## wait()
wait() 함수는 자식 프로세스가 종료될 때까지 기다리는 시스템 콜이다. wait() 함수를 사용하면 부모 프로세스가 자식 프로세스가 종료될 때까지 기다릴 수 있다. 이렇게 함으로써
부모 프로세스가 자식 프로세스 보다 먼저 종료되지 않고 자식 프로세스를 부모 프로세스가 회수할 수 있다.(고아 프로세스 방지) 
```c
int main() {
  int pid;
  
  pid=fork();
  
    if(pid==0) {
        printf("자식 프로세스\n");
        exit(0);
    }
    else {
        wait(NULL);
        printf("부모 프로세스\n");
        exit(0);
    }
}
```
위 코드에는 wait() 함수가 추가되었다. wait() 함수는 자식 프로세스가 종료될 때까지 기다린다. 자식 프로세스가 종료되면 부모 프로세스가 실행된다.