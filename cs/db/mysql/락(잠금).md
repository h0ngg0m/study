# 락 (잠금)

## 글로벌 락
- MySQL에서 제공하는 잠금 가운데 가장 범위가 크다.
- 한 세션에서 글로벌 락을 획득하면 다른 세션에서 SELECT 를 제외한 대부분의 DDL 문장이나 DML 문장을 실행하는 경우 글로벌 락이 해제될 때까지 해당 문장이 대기 상태로 남는다.

## 테이블 락
- 테이블 락은 개별 테이블 단위로 설정되는 잠금이다. 명시적 또는 묵시적으로 특정 테이블의 락을 획득할 수 있다.
- 묵시적인 테이블 락: InnoDB 기준 DML 쿼리에서는 무시되고, 스키마를 변경하는 DDL 쿼리에서만 획득된다.

## 네임드 락
- 네임드 락은 GET_LOCK() 함수를 사용하여 임의의 문자열에 대해 잠금을 설정할 수 있다. 이 잠금의 특징은 대상이 테이블 또는 레코드 또는 AUTO_INCREMENT와 같은 데이터베이스 객체가
아니라는 점이다.
- 단순히 사용자가 지정한 문자열에 대해 획득하고 반납하는 잠금이다. 자주 사용되지는 않는다.
  - 사용되는 경우 예시: 많은 레코드에 대해서 복잡한 요건으로 레코드를 변경하는 트랜잭션에 유용하게 사용 가능.

## 메타데이터 락
- 데이터베이스 객체의 이름이나 구조를 변경하는 경우에 획득하는 잠금이다. 메타데이터 락은 명시적으로 획득하거나 해제할 수 있는 것이 아니고
"RENAME TABLE"과 같이 테이블의 이름을 변경하는 경우 자동으로 획득하는 잠금이다.

## 레코드 락
- 레코드 자체만을 잠그는 것을 레코드 락이라고 하며, 다른 사용 DBMS의 레코드 락과 동일한 역할을 한다.
- 한 가지 중요한 차이는 InnoDB 스토리지 엔진은 레코드 자체가 아니라 인덱스의 레코드를 잠근다는 점이다. 인덱스가 하나도 없는 테이블이더라도 내부적으로 
자동 생성된 클러스터 인덱스를 이용해 잠금을 설정한다.

## 갭 락
- 갭 락은 레코드 자체가 아니라 레코드와 바로 인전합 레코드 사이의 간격만을 잠그는 것는 의미한다. 갭 락의 역할은 레코드와 레코드 사이의 간격에
새로운 레코드가 생성되는 것을 제어하는 것이다. 갭 락은 그 자체보다는 넥스트 키 락의 일부로 자주 사용된다.

## 넥스트 키 락
- 레코드 락과 갭 락을 합쳐 놓은 형태의 잠금을 넥스트 키 락이라고 한다.

## 자동 증가 락
- AUTO_INCREMENT 컬럼이 사용된 테이블에 동시에 여러 레코드가 INSERT 되는 경우, 저장되는 각 레코드는 중복되지 않고 저장된 순서대로 증가하는
일련번호 값을 가져야 하는데 이때 이를 위해 내부적으로 AUTO_INCREMENT 락이라고 하는 테이블 수준의 잠금을 사용한다.

## 인덱스와 잠금
- InnoDB의 잠금은 레코드를 잠그는 것이 아니라 인덱스는 잠그는 방식으로 처리된다. 즉, 변경해야 할 레코드를 찾기 위해 인덱스의 레코드를 모두 락을 걸어야 한다.
- ex) first_name이 인덱스이고 해당 테이블에 100개의 레코드가 있고 모든 레코드의 first_name이 'John'인 경우, first_name이 'John'인 조건으로 UPDATE 문을 
실행할 때 100개의 레코드를 모두 잠가야 한다. 이때 다른 클라이언트는 해당 레코드에 접근할 수 없다.